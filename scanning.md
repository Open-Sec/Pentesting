# SCANNING (ESCANEANDO)

Esta etapa es la primera en usar la información de **RECON** y la que prepara todo para la siguiente ( **TESTING** ) donde se explotan las vulnerabilidades de ser el caso.
Por ello, esta etapa arranca buscando servicios expuestos en los targets dentro del alcance (para esta etapa, los hosts ya estan definidos como targets de los ataques que empiezan por buscar vulnerabilidades).

Luego, se identifica el software que soporta los servicios encontrados y empieza la búsqueda de vulnerabilidades que puede basarse, inicialmente, usar bases de datos públicas respecto a los banners obtenidos y hasta usar herramientas de escaneo de vulnerabilidades automatizadas.
Se requiere tener una confirmación manual en todo lo posible o por lo menos definir las condiciones para ir a explotar vulnerabilidades en la siguiente etapa (aspectos como posibles DoS, bloqueo de cuentas, contextos de versiones/tiempos, etc.)

Dado que esta etapa inicia con acciones más intrusivas y que generan tráfico facilmente detectable, es importante tener en consideración la necesidad de pasar por alto la protección establecida en la organización evaluada desde simples firewalls hasta preventores y el resto de parafernaria de defensa que se haya establecido.
La obligación de un pentest en evadir dichas protecciones varía según el alcance y el tiempo asignado que deben haber sido aceptados de común acuerdo. Sin embargo, cuando menos el reporte debería documentar los esfuerzos por evadir las protecciones así estos hayan sido inútiles.
También, es factible que se propongan excepciones y se conceda acceso privilegiado.  Esto no es muy recomendable en pruebas sobre infraestructura y es casi siempre lo incluído en pruebas sobre aplicaciones (pruebas con privilegios o crendenciales o post autenticación).

## Vulnerability Identification (Identificación de Vulnerabilidades)

La identificación inicia buscando puertos abiertos en los targets.  Otro tipo de estado puede ser complementario.  Por ejemplo, saber cuáles puertos están filtrados puede ayudar a confirmar alguna protección entre los pentesters y los targets (que se debería tratar como se explico anteriormente).
Los escaneos por TCP son los más relevantes aún y por UDP hacia puertos bien conocidos usados por DNS, SNMP y VoIP.
La mejor postura respecto al escaneo de puertos es conducirlo de menos a más porque se debe reconocer equipos sensibles (se deberían haber identificado antes de iniciar cualquier acción y durante la planificación del pentest, pero, en el mundo real...) y las protecciones que podrían entorpecer la labor. Por ejemplo, reconocer el bloqueo de un IPS de forma temprana ayudará a realizar un proceso de evasión temprano más aún en la etapa de escaneo de puertos porque los IPSs suelen no implementar este tipo de protecciones y sí estan activas, lo están por default (se puede identificar umbrales de detección y bloqueo).

La identificación del software que usa un puerto determinado debe realizarse mediante el handshake inicial cuando menos (como lo hace NMAP, por ejemplo), pero, pocas veces el banner del software ha sido modificado.  De cualquier forma, es obligación del pentest la confirmación exacta del software usado en el servicio expuesto.
En el caso que no haya una herramienta que consiga identificarlo y solamente se obtengan "firmas" desconocidas, por lo menos, se debería buscar en Internet estas firmas, los puertos/protocolos que estan siendo usados, intentar fuzzear de manera básica el servicio.

Una vez identificados los servicios, el paso natural es usar herramientas de escaneo de vulnerabilidades automatizadas.
Hoy en día la emisión de falsos positivos por parte de las herramientas es cercano al cero.  Solamente una pésima configuración o un desconocimiento enorme de como conducir un pentest podría dar lugar a considerar un resultado como falso positivo.
Entonces, la configuración de los perfiles del escaneo y la interpretación de los resultados se convierte en las acciones más importantes. Un escaneador no servirá para encadenar vulnerabilidades o interpretar el contexto de un resultado que haya obtenido.

## Attack Vector Design (Diseño del Vector de Ataque)

Con toda la información obtenida, se debe proceder a elaborar una lista de posibles acciones de explotación de vulnerabilidades que pueden tener niveles diversos.  Desde aquellas que pueden servir para penetrar una red interna desde Internet o acceder a un segmento de red no autorizado o exfiltrar información o pasar por alto un control de autenticación o permitir realizar una inyección o acceder a una función no autorizada o cometer un fraude hasta aquellas que parecen meramente informativas (que deben ser calificadas como tales).

Algunos ejemplos de vulnerabilidades pueden parecer triviales o cuya explotación ha quedado relegada al ámbito académico (investigaciones ciertas que no son realizadas en el mundo real).  El empleo de versiones obsoletas de software o de protocolos pueden conducir a que la organización evaluada incumpla los requerimientos de una auditoría en particular (como las de PCI DSS). Sin importar si se consideran explotables o no, deben ser reportadas.
La no existencia de un exploit público o una técnica documentada para explotar una vulnerabilidad, no implica que no pueda ser explotable ya sea porque si existe un exploit o una técnica y no son públicos.
La calificación del riesgo no es factible y por ello se deben calificar como informacion complementaria del pentest.

Se deben considerar casos de vulnerabilidades parcialmente explotadas y más aún cuando las "vulnerabilidades en cadena" se vienen haciendo cada vez más comúnes.  El diseño del vector de ataque debe considerar la especificación de los resultados parciales y su interpretación porque ello permitirá reportar y calificar adecuadamente.

También, se deben establecer los criterios para considerar una explotación exitosa para las acciones de explotación que se propondrán para la siguiente etapa.  Nuevamente, esto depende mucho del alcance, el tiempo y el contexto del pentest.
De hecho, es factible que a este punto se hayan encontrado vulnerabilidades que no corresponde al alcance del pentest, pero, deberían ser reportadas. Por ejemplo, durante un pentest interno de un conjunto de targets especificados por la organización evaluada, el usar los servidores DNS internos para realizar una acción de exfiltración o establecer una jump box que se acceda sin control, deben ser reportados.

## Vulnerability Confirmation (Confirmación de la Vulnerabilidad)

Un pentest tiene la obligación de reportar vulnerabilidades explotadas o para las cuales se ha obtenido un PoC valido. 
El límite entre confirmar y explotar una vulnerabilidad puede ser complejo.
Existe frameworks de explotación de vulnerabilidades y programas de explotación (principalmente los del tipo PoC) que tienen opciones de validación y no explotación, pero, no es lo más común.

La confirmación de las vulnerabilidades se puede dar por realizada sí más de una herramienta de escaneo automatizado entrega los mismos resultados, por ejemplo. Esto no garantiza una explotación exitosa en cualquier caso, pero, es lo más lógico y coherente que sí dos herramientas reportan lo mismo, debe ser valido.

En otros casos, la confirmacion deberá ser hecha "a mano" bien sea mediante el empleo de herramientas de propósito general o el uso de programas (scripts) específicos o creándolos.  Un tipo de respuesta o un mensaje o un código de error en particular pueden ser la confirmación de la existencia de una vulnerabilidad.
Un ejemplo muy trillado, pero, útil se da con las inyecciones de SQL (si, aún en el 2022 existen) : en el caso de las visibles o basadas en mensajes de error, se pueden identificar mediante el uso de una comilla simple y la obtención de un mensaje de error de sintáxis.  Para comprobarla, se puede avanzar más con enumerar otro dato (base de datos en uso, cuenta de usuario utilizada, lista de bases de datos, etc.). La explotación, posterior, es la que permitirá conocer el riesgo real, es decir, sí solamente se puede leer información (toda, alguna) o tambíen alterarla (o eliminarla) o interactuar con el sistema de archivos subyacente o interactuar con el sistema operativo subyacente, etc.

## Elementos empleados durante el SCANNING

### Escaneo de Puertos y Servicios

- NMAP
- Wireshark o tshark

**Las siguientes secciones involucran elementos que son dependientes de los hallazgos.  Por ende, solamente se referencian elementos que cuentan con la capacidad de ayduar en la comprobación de vulnerabilidades en varios tipos de targets (sistemas operativos/software de base/aplicaciones). De la misma forma, en el caso de aplicaciones, habrán herramientas diversas dependiendo del tipo de pruebas (DAST/SAST/IAST).**

### Búsqueda automatizada de vulnerabilidades

- NMAP
- Nessus
- Nuclei
- Burp
- En el caso de webs (infraestructura) y aplicaciones web, la búsqueda de directorios y archivos es importante : Burp, gobuster, dirb, wfuzz, NMAP. Apoyándose en las SecLists.
- En redes MS Windows : Responder.py, crackmapexec, Impacket tools, Powersploit
- En móviles : MobSF, Burp

### Comprobaciones

- NMAP
- Metasploit
- Burp
- MobSF
